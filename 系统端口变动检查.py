#!/usr/bin/env python
# -*- coding: UTF-8 -*-
'''
@Project ：端口变动检测 
@File    ：端口变动检测.py
@IDE     ：记事本 
@Author  ：chat gpt
@Date    ： 
'''

import tkinter as tk
from tkinter import messagebox
import serial.tools.list_ports
import time
from win10toast import ToastNotifier
import threading
import sys
import os
from PIL import Image, ImageDraw
from pystray import Icon, MenuItem, Menu
import binascii

icon_path = "./favicon.ico"
image = "./1.png"
hex_icon = "000001000300101000000100200068040000360000002020000001002000281100009e040000303000000100200068260000c615000028000000100000002000000001002000000000000000000000000000000000000000000000000000000000002e2e2e2132323247333333aa333333c2323232bc323232a7333333ae333333a03333339b3333339633333378333333793232325b2a2a2a0c000000003333331e323232c1333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ea323232a92a2a2a0c31313172333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fe3434344f323232ad333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333b4323232bb333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333f5333333f2333333ff333333d1333333ff323232db323232c5333333ff3333335a323232a9333333ff323232f33434342c333333d8333333e83232324d3333335531313144303030203232328a333333ff333333cd323232ad333333ff333333ed30303030323232e93333336a32323290333333ff32323252323232b7333333ff32323294333333823232325c333333ff333333db333333d7333333ff333333ff323232bb2f2f2f3631313144333333fd333333fb33333323333333ff333333ff333333ff333333fe30303025333333ff333333dd323232d0333333ff333333ff333333ec2e2e2e1633333381333333ff333333f72f2f2f26333333ff333333ff333333ff333333ff34343427333333ff333333db333333c9333333ff333333ff34343454333333ab31313139333333cf333333ff31313134333333db333333ff333333ff333333ce32323248333333ff333333d1333333e2333333ff333333a132323257333333ff333333d232323233333333f7323232c02f2f2f31333333973333339230303030323232d0333333ff333333c8333333ef333333ff333333d3333333f0333333ff333333ff323232d6333333ef333333ff323232e9323232a8333333ab333333ee333333ff333333ff333333f6333333d7333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ba34343463333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff3434348000000001333333a6333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fa323232da333333ec333333fc333333ba3333330a0000000000000000323232293232328e33333397333333ba323232ac323232a73232329a333333a9333333b53232329d323232ad32323257000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000280000002000000040000000010020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000003434342c3333337d3333339c32323270333333863131316d3434344f3434344f33333369323232523232324c30303035323232333030303a333333323131312a2a2a2a0c000000002f2f2f363232326b3131311a3737370e000000000000000000000000000000000000000000000000202020083131317c32323257323232c5333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232fd333333d8333333b43333339132323280333333c33232322e00000002000000000000000000000000000000033232328f323232a7333333fe333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232ad3333339b3333338c00000000000000000000000032323276323232d0333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232c6323232b834343431000000002d2d2d11323232b7333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fd343434440000000032323252323232ad333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232f44040400433333374333333e7333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232473232325b333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff3333338c32323299333333f1333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232b132323280333333e3333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fa333333dd333333d9323232f3333333ff333333fe32323298343434ad333333ff333333ff333333ff323232bc333333b0333333f2333333ff333333ff3232325b20202008323232a7333333ff333333ff333333ff333333ff333333ff33333381202020083333336e333333ff333333ff333333ff333333c83434344e202020080000000000000000000000023535353a3434344520202008333333a0333333ff333333ff333333ff32323299333333a5333333cf333333ff333333ff333333ec3131311a33333314323232e9333333ff333333ff333333ff333333cf3333330532323224323232f3333333ff333333ff343434a3404040042f2f2f1b32323289333333c3323232c23232324c000000000000000033333383333333ff333333ff333333ff333333ff3232329d33333387333333c9333333ff333333ff333333ff333333b80000000131313153333333ff333333ff333333fa3030303000000003323232c5333333ff333333ff333333d9242424073434342c333333ed333333ff333333ff323232b8404040043030304a2e2e2e163b3b3b0d333333e7333333ff333333ff333333ff333333bf3333338b323232da333333ff333333ff333333ff333333ff3333336d00000000323232a8333333ff32323280000000003232327a333333ff333333ff333333ff3333336900000000333333c4333333ff333333ff333333ff323232f83333339c333333fd333333ab000000003333337d333333ff333333ff333333ff333333b0323232b7323232fd333333ff333333ff333333ff333333ff333333f63131312a33333314333333ba3333330534343431333333f9333333ff333333ff333333ff3737371c36363621333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232fd3333331433333332333333ff333333ff333333ff333333ba333333ab333333ff333333ff333333ff333333ff333333ff333333ff333333ce2a2a2a060000000324242407333333d3333333ff333333ff333333ff333333ef000000003434344f333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232422a2a2a0c333333ff333333ff333333ff333333be3333339b333333ff333333ff333333ff333333ff333333ff333333ff333333ff31313149000000003131314e333333ff333333ff333333ff333333ff333333e30000000031313158333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff3232324739393909333333ff333333ff333333ff333333b5333333a6333333ff333333ff333333ff333333ff333333ff333333ff333333b3000000003030301000000001343434b7333333ff333333ff333333ff333333fa2a2a2a063434343b333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff3232322432323229333333ff333333ff333333ff323232bb32323280333333ff333333ff333333ff333333ff333333ff333333ea2c2c2c172f2f2f1b333333de3333331933333319333333ec333333ff333333ff333333ff3131313920202008333333f0333333ff333333ff333333ff333333ff333333ff333333ff333333dc0000000031313162333333ff333333ff333333ff333333be323232a7333333ff333333ff333333ff333333ff333333ff3434344f00000000323232b3333333ff323232b20000000034343454333333ff333333ff333333ff33333391000000003333337e333333ff333333ff333333ff333333ff333333ff333333ff3232326000000000323232bd333333ff333333ff333333ff33333387333333b4333333ff333333ff333333ff333333ff3333339c000000003232325b333333ff333333ff333333ff3131315e00000000333333a1333333ff333333ff333333f73131312a0000000333333390333333fa333333ff333333ff333333f5333333740000000032323251333333ff333333ff333333ff333333ff32323294333333d6333333ff333333ff333333ff333333dd2727270d2e2e2e16333333eb333333ff333333ff333333ff333333ee2f2f2f1b3333330f323232e0333333ff333333ff333333e130303030000000002e2e2e163232324d323232473737370e000000003333334b333333f2333333ff333333ff333333ff333333ff33333390333333e1333333ff333333ff333333ff333333be3232328f323232c5333333ff333333ff333333ff333333ff333333ff323232ca3232328f323232c0333333ff333333ff333333ff333333fb323232ac3131316234343440313131433232326b333333bd333333ff333333ff333333ff333333ff333333ff333333ff333333f7333333dc333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333e5333333ce333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232ac3232328f333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff3131313e36363626333333f6333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff343434400000000032323271333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333c200000000000000002a2a2a06323232d5333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232f33131312a0000000000000000000000003333330a333333b9333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ea323232b3323232b6333333cf323232e4323232f3333333ff323232c1313131340000000000000000000000000000000000000000000000023232322432323280323232c0333333c2333333c8323232c6333333fd333333ff333333ff333333ff343434c1323232bd323232b7333333be333333f9333333ff333333ff333333ff333333f4323232ee333333ff333333ff333333eb3232326700000001000000000000000000000000000000000000000000000000000000000000000000000000333333373333338133333378313131583333338832323266313131443333336e3232329d33333381323232753333337e3333336f3131313e3333337232323265323232672f2f2f2b333333693232324c39393909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000280000003000000060000000010020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000003333330a3333331e3232323d3131315d31313144303030253232323d32323229333333233737371c333333193737371c33333323363636213131311a353535183131311a3737370e3030301033333314363636132d2d2d11303030103b3b3b0d2a2a2a0600000000000000002a2a2a1233333323323232242a2a2a0c2a2a2a06000000020000000000000000000000000000000000000000000000000000000000000000000000000000000040404004313131492f2f2f2b33333314343434593232329d333333d7333333fc333333ff333333fc333333e5333333ff333333f9333333e7333333d3333333c9333333d4333333e8333333e1333333cd333333c7333333cd343434a8333333af333333ba333333b8323232b2333333af323232a73333339232323271323232513232325b323232803232327b34343463323232803232326b2a2a2a0c000000000000000000000000000000000000000000000000000000000000000040404004323232663232327b3333334b333333c4333333f2333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fa333333ef333333e7333333e0333333d23232328e34343463333333d23232325b2828281300000001000000000000000000000000000000000000000000000002343434533232329333333392333333fc333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333da3232325c333333b5333333d13434343600000000000000000000000000000000000000003333334b333333b9333333c9333333fb333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333f33333338c33333381323232c03333331400000000000000000000000033333323323232bd343434c1323232fd333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333f5333333a6333333e33333336f000000000000000000000002333333743333339c333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fb3333333740404004000000002d2d2d113232328e333333aa333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333cf34343440000000003131311f32323295333333dd333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fd33333381000000023131312f333333cd333333f4333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333b93636361332323256323232c6333333fd333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ec333333283333336834343494333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fe3333335032323298323232bc333333fc333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff3333337934343494323232ac333333f6333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fb333333e7333333fb333333ff333333ff333333ff333333ff333333ff3434347633333386333333a0333333f6333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fc323232df323232c1323232bd323232d1333333f6333333ff333333ff323232fd323232893232322e343434c0333333ff333333ff333333ff333333ff333333ff333333a93232328e333333dc323232fd333333ff333333ff333333ff303030653333330f2727270d3434349e333333fd333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333d53434342c2727270d2f2f2f2b323232ca333333ff333333ff333333ff333333ff333333f5323232c5333333682e2e2e160000000000000000000000000000000024242407323232483434349d323232470000000135353518323232a2333333ff333333ff333333ff333333ff333333f83333338b34343494323232d6333333f4333333ff333333ff333333ff333333dc323232330000000034343422333333cd333333ff333333ff333333ff333333ff333333ff333333ff333333f63434344f000000000000000332323293323232fd333333ff333333ff333333ff333333e4333333682d2d2d1100000000242424073232322e32323248323232483131312a404040040000000000000000000000003333332d333333b5333333fb333333ff333333ff333333ff333333ff333333cc323232603333338b333333ab333333ef333333ff333333ff333333ff333333fd333333a43737370e0000000232323261323232f3333333ff333333ff333333ff333333ff333333ff3333338655555503000000003333335f333333f8333333ff333333ff333333ff333333e83535354300000002000000013333334b333333c3323232e4333333ec333333ec333333d43232323800000000000000000000000036363639333333ee333333ff333333ff333333ff333333ff333333ff333333ee323232993232328533333391333333ed333333ff333333ff333333ff333333ff333333fa323232600000000140404008333333af333333ff333333ff333333ff333333fe343434c635353518000000003333332d333333e1333333ff333333ff333333ff333333f93232327a404040042a2a2a0633333373333333f5333333ff333333ff333333ff333333ef3131315800000003303030103131311f55555503404040083333338d333333fc333333ff333333ff333333ff333333ff333333ff3333339a3232328532323290333333ee333333ff333333ff333333ff333333ff333333ff323232e9333333370000000034343422333333da333333ff333333ff333333ef33333355000000023737370e333333a1333333fc333333ff333333ff333333ff323232da2e2e2e210000000031313144333333e9333333ff333333ff333333ff333333ff333333ea3333334b3232322e323232a8323232cc323232290000000032323233333333e5333333ff333333ff333333ff333333ff333333ff333333833333338b333333aa333333f5333333ff333333ff333333ff333333ff333333ff333333ff333333c835353518000000003232324d333333f5333333ff3333339c24242407000000003131315d333333f6333333ff333333ff333333ff333333ff343434940000000100000000333333bf333333ff333333ff333333ff333333ff333333ff333333fe333333e2333333e1333333fe333333fe3333339c0000000040404004323232b1333333ff333333ff333333ff333333ff333333ff3333337c32323299333333e0333333fe333333ff333333ff333333ff333333ff333333ff333333ff333333fa333333832a2a2a062e2e2e0b3333339a333333d63333330f0000000034343427333333ef333333ff333333ff333333ff333333ff333333ff3535353e0000000037373725333333fe333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333f92d2d2d110000000031313162333333ff333333ff333333ff333333ff333333ff33333388323232a7333333f6333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333e634343444000000003434342c323232330000000035353518333333ba333333ff333333ff333333ff333333ff333333ff333333f82a2a2a0c0000000032323266333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff3030304f000000003333332d333333ff333333ff333333ff333333ff333333ff32323294333333a1333333ce333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333d82d2d2d1100000001000000004040400433333378333333f8333333ff333333ff333333ff333333ff333333ff333333dd00000000000000003333338b333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff32323275000000003333330f333333ff333333ff333333ff333333ff333333ff33333392333333a5333333bf333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff3232328b00000000000000003333331e333333d7333333ff333333ff333333ff333333ff333333ff333333ff333333cc000000000000000032323298333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff3333337c0000000040404008333333ff333333ff333333ff333333ff333333ff33333386323232b6323232ca333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333e43434343100000000000000002e2e2e0b33333391333333fa333333ff333333ff333333ff333333ff333333ff333333e4000000000000000032323280333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff3333335f0000000030303025333333ff333333ff333333ff333333ff333333ff33333383323232b6323232c0333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333f9343434580000000030303010292929190000000030303020333333d7333333ff333333ff333333ff333333ff333333ff333333fc2d2d2d110000000033333355333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff3333332d0000000032323251333333ff333333ff333333ff333333ff333333ff32323295333333a5323232a2333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fd3333339f3b3b3b0d5555550332323270323232c53333330f0000000032323247333333f4333333ff333333ff333333ff333333ff333333ff3434344a0000000031313115333333f6333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333dd00000001000000003232328e333333ff333333ff333333ff333333ff333333ff333333a532323298333333c7333333ff333333ff333333ff333333ff333333ff333333ff333333ff343434d93131312f000000002f2f2f2b333333d7333333ff3333339024242407000000003333337e333333fa333333ff333333ff333333ff333333ff3333339f00000001000000003333339c333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232fd34343470000000002d2d2d11323232d0333333ff333333ff333333ff333333ff333333ff3232325c3333339b333333de333333ff333333ff333333ff333333ff333333ff333333ff333333fe323232510000000200000001333333b0333333fe333333ff333333ed333333500000000031313115333333b4333333ff333333ff333333ff333333ff333333de36363626000000003131312a333333dc333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232c13131311a000000003434344f333333ef333333ff333333ff333333ff333333ff333333ff3232323333333386333333ff333333ff333333ff333333ff333333ff333333ff333333fc33333391000000000000000234343467333333ff333333ff333333ff333333ff333333bf3131311a0000000032323242333333e6333333ff333333ff333333ff333333fb343434852a2a2a060000000232323256333333dd333333fc333333ff333333ff333333ff333333ff333333f9333333cd343434360000000033333314333333b0333333ff333333ff333333ff333333ff333333ff333333ff323232513333338d333333ff333333ff333333ff333333ff333333ff333333ff323232c13131311a0000000032323233333333df333333ff333333ff333333ff333333ff333333fc33333386000000000000000332323275333333fe333333ff333333ff333333ff333333e73232325b00000000000000013131313433333383333333b5333333d2333333ce323232ac3333337430303020000000004040400833333388333333f9333333ff333333ff333333ff333333ff333333ff333333fa34343436333333cf333333ff333333ff333333ff333333ff333333ff333333ed3232324d000000013b3b3b0d3434349e333333fd333333ff333333ff333333ff333333ff333333ff333333f63434344a0000000040404008333333aa333333ff333333ff333333ff333333ff333333ee33333379393939090000000040404004393939123737371c3131311a3333330f00000002000000003131311a333333a4333333f8333333ff333333ff333333ff333333ff333333ff333333ff333333f532323270323232e4333333ff333333ff333333ff333333ff333333ff323232c532323247343434453333336a333333f7333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333db3030304f3434344533333364333333f0333333ff333333ff333333ff333333ff333333fd333333c83232325b323232243131311a33333314313131153737371c3232322933333373323232df333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ef333333aa333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ea333333cc343434bc333333bf333333d3333333f2333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ee333333d7333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333c8343434bc333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333873333337e333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff323232e43030303a33333337333333f9333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333b53939391233333314343434b7333333fe333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333d12f2f2f1b0000000132323247333333e9333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fb343434852a2a2a0600000000404040043333338c333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333e23434342c0000000000000000000000002d2d2d11333333e1333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333f83333336e000000000000000000000000000000000000000031313143323232c1333333fc333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333fd333333ef323232fd333333ff333333ff333333ee323232843333330500000000000000000000000000000000000000000000000133333328323232c7333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333ff333333c7323232843333337c3232328a323232a9333333c4333333d8333333f9333333fe333333ff333333bd3131313f404040080000000000000000000000000000000000000000000000000000000000000000242424073434343632323280333333d4333333df333333da333333ec333333ed333333eb333333ed333333fe333333ff333333ff333333ff333333ff333333ff333333f0333333e5333333ea333333e7333333e6333333eb333333fc333333ff333333ff333333ff333333ff333333ff333333fe333333f6323232fd333333ff333333ff333333ff333333fd333333e43333337800000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002727270d343434853333339c343434c6323232c6323232ac33333397333333f3333333ef333333e2333333c7333333c9333333f6333333d1323232b1323232b3323232a9333333a6323232c1333333ec333333d7323232b6333333e6333333f4333333e1333333e3323232b1333333a0323232e9333333e1333333c33333338833333337404040040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a2a2a0c343434223030303a3434342c3333332333333323323232513232322e2e2e2e213535351833333319333333373131315e3535354d343434313333332d3232323330303030343434273535351d3939391233333323323232292e2e2e21333333233131311a3b3b3b0d333333233636362137373717333333050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"

# 将十六进制字符串转回二进制数据
def hex_to_bin(hex_string):
    return binascii.unhexlify(hex_string)



# 初始化通知对象
toaster = ToastNotifier()

# 获取当前的COM端口
def get_com_ports():
    ports = [port.device for port in serial.tools.list_ports.comports()]
    return set(ports)

# 显示系统通知
def show_notification(added_ports, removed_ports):
    if added_ports:
        toaster.show_toast("COM Port Added", f"New port(s) detected: {', '.join(added_ports)}", icon_path=icon_path, duration=3, threaded=False)
    if removed_ports:
        toaster.show_toast("COM Port Removed", f"Port(s) removed: {', '.join(removed_ports)}", icon_path=icon_path, duration=3, threaded=False)

def monitor_com_ports():
    # 获取初始的COM端口
    previous_ports = get_com_ports()

    while True:
        time.sleep(1)  # 每5秒检查一次

        # 获取当前的COM端口
        current_ports = get_com_ports()

        # 检查新增和移除的端口
        added_ports = current_ports - previous_ports
        removed_ports = previous_ports - current_ports

        # 如果有变化，显示通知
        if added_ports or removed_ports:
            show_notification(added_ports, removed_ports)

        # 更新之前的COM端口列表
        previous_ports = current_ports

# 创建托盘图标
def create_tray_icon():
    # 创建一个简单的图标
    image = Image.open(icon_path)


    # 创建右键菜单
    menu = Menu(
        MenuItem("串口动态监控", none_),
        MenuItem("作者：xq", none_),
        MenuItem("退出", on_exit)
    )

    # 创建图标
    icon = Icon("COM Monitor", image, menu=menu)
    icon.run()

def none_():
    pass

# 退出程序
def on_exit(icon, item):
    remove_lock_file()  # 程序退出时删除锁文件
    icon.stop()
    sys.exit(0)

# 弹出程序已在运行的提示窗口
def show_program_running_popup():
    root = tk.Tk()
    root.withdraw()  # 隐藏主窗口
    messagebox.showwarning("Program Already Running", "The program is already running. Exiting...")
    root.quit()

LOCK_FILE = "com_monitor.lock"  # 锁文件路径

# 创建锁文件
def create_lock_file():
    if os.path.exists(LOCK_FILE):
        show_program_running_popup()
        print("Another instance is already running. Exiting...")
        sys.exit(0)
    else:
        with open(LOCK_FILE, 'w') as lock_file:
            lock_file.write("LOCKED")

# 删除锁文件
def remove_lock_file():
    if os.path.exists(LOCK_FILE):
        os.remove(LOCK_FILE)

if __name__ == "__main__":
    create_lock_file()  # 检查是否有程序在运行

    # 将十六进制转换为二进制
    icon_data = hex_to_bin(hex_icon)
    # 临时保存为 .ico 文件（为了显示通知）
    if not os.path.exists(icon_path):
        with open(icon_path, "wb") as f:
            f.write(icon_data)

    try:
        # 在后台线程中启动 COM 端口监控
        threading.Thread(target=monitor_com_ports, daemon=True).start()
        
        # 创建系统托盘图标
        create_tray_icon()
    finally:
        remove_lock_file()  # 程序退出时删除锁文件



        
